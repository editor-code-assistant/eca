{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://eca.dev/config.json",
  "title": "ECA Configuration",
  "description": "Configuration schema for ECA (Editor Code Assistant). See https://eca.dev/configuration for full documentation.",
  "type": "object",
  "additionalProperties": false,
  "allowComments": true,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference for editor validation support."
    },
    "providers": {
      "type": "object",
      "description": "LLM provider configurations. Each key is the provider name.",
      "additionalProperties": {
        "$ref": "#/definitions/provider"
      }
    },
    "defaultModel": {
      "type": ["string", "null"],
      "description": "Default model in format 'provider/model'. When null, ECA decides the default model.",
      "examples": ["anthropic/claude-sonnet-4.5", "openai/gpt-5.2"]
    },
    "defaultBehavior": {
      "type": "string",
      "description": "The default behavior to use for new chats.",
      "default": "agent",
      "examples": ["agent", "plan"]
    },
    "behavior": {
      "type": "object",
      "description": "Named behavior configurations for different workflows.",
      "additionalProperties": {
        "$ref": "#/definitions/behavior"
      }
    },
    "hooks": {
      "type": "object",
      "description": "Shell actions that run before or after specific events.",
      "additionalProperties": {
        "$ref": "#/definitions/hook"
      }
    },
    "rules": {
      "type": "array",
      "description": "Rules are contexts passed to the LLM during a prompt, useful to tune prompts or LLM behavior.",
      "items": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string",
            "description": "Path to a rule file (relative to workspace root or absolute)."
          }
        },
        "required": ["path"],
        "additionalProperties": false
      }
    },
    "enabledSkills": {
      "type": "array",
      "description": "List of regex patterns matching skill names to enable. Defaults to all skills enabled.",
      "items": {
        "type": "string"
      },
      "default": [".*"]
    },
    "disabledTools": {
      "type": "array",
      "description": "List of tool names to disable globally.",
      "items": {
        "type": "string"
      }
    },
    "commands": {
      "type": "array",
      "description": "Custom command prompt files.",
      "items": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string",
            "description": "Path to a command prompt markdown file."
          }
        },
        "required": ["path"],
        "additionalProperties": false
      }
    },
    "customTools": {
      "type": "object",
      "description": "User-defined command-line tools the LLM can use.",
      "additionalProperties": {
        "$ref": "#/definitions/customTool"
      }
    },
    "toolCall": {
      "$ref": "#/definitions/toolCallConfig"
    },
    "mcpTimeoutSeconds": {
      "type": "integer",
      "description": "Timeout in seconds for MCP server operations.",
      "default": 60
    },
    "lspTimeoutSeconds": {
      "type": "integer",
      "description": "Timeout in seconds for LSP operations.",
      "default": 30
    },
    "mcpServers": {
      "type": "object",
      "description": "MCP (Model Context Protocol) server configurations.",
      "additionalProperties": {
        "$ref": "#/definitions/mcpServer"
      }
    },
    "prompts": {
      "$ref": "#/definitions/prompts"
    },
    "welcomeMessage": {
      "type": "string",
      "description": "Custom welcome message shown when ECA starts."
    },
    "autoCompactPercentage": {
      "type": "integer",
      "description": "Context window usage percentage at which auto-compact triggers.",
      "minimum": 0,
      "maximum": 100,
      "default": 75
    },
    "index": {
      "type": "object",
      "description": "Indexing configuration for workspace files.",
      "additionalProperties": false,
      "properties": {
        "ignoreFiles": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string",
                "description": "Type of ignore file to use.",
                "examples": ["gitignore"]
              }
            }
          }
        },
        "repoMap": {
          "type": "object",
          "description": "Repository map configuration for context building.",
          "additionalProperties": false,
          "properties": {
            "maxTotalEntries": {
              "type": "integer",
              "description": "Maximum total entries in the repo map.",
              "default": 800
            },
            "maxEntriesPerDir": {
              "type": "integer",
              "description": "Maximum entries per directory in the repo map.",
              "default": 50
            }
          }
        }
      }
    },
    "completion": {
      "type": "object",
      "description": "Inline completion configuration.",
      "additionalProperties": false,
      "properties": {
        "model": {
          "type": "string",
          "description": "Model to use for inline completions.",
          "default": "openai/gpt-4.1",
          "examples": ["openai/gpt-4.1", "github-copilot/gpt-4.1"]
        }
      }
    },
    "rewrite": {
      "type": "object",
      "description": "Rewrite feature configuration.",
      "additionalProperties": false,
      "properties": {
        "model": {
          "type": "string",
          "description": "Model to use for rewrites. Defaults to the same model selection as chat.",
          "examples": ["openai/gpt-4.1", "github-copilot/gpt-4.1"]
        }
      }
    },
    "otlp": {
      "type": "object",
      "description": "OpenTelemetry OTLP collector configuration. Keys follow otlp auto-configure settings.",
      "additionalProperties": {
        "type": "string"
      }
    },
    "netrcFile": {
      "type": ["string", "null"],
      "description": "Path to a custom netrc credential file. When null, searches ~/.netrc or ~/_netrc.",
      "default": null
    }
  },
  "definitions": {
    "provider": {
      "type": "object",
      "description": "Configuration for an LLM provider.",
      "properties": {
        "api": {
          "type": "string",
          "description": "The API protocol to use for this provider.",
          "enum": ["openai-responses", "openai-chat", "anthropic"]
        },
        "fetchModels": {
          "type": "boolean",
          "description": "Whether to fetch available models from the provider's API."
        },
        "url": {
          "type": "string",
          "description": "Base URL for the provider's API. Supports dynamic strings like ${env:VAR}.",
          "format": "uri"
        },
        "key": {
          "type": ["string", "null"],
          "description": "API key for authentication. Supports dynamic strings like ${env:MY_API_KEY}."
        },
        "keyRc": {
          "type": "string",
          "description": "Credential file lookup in format [login@]machine[:port] for netrc-based authentication."
        },
        "requiresAuth": {
          "type": "boolean",
          "description": "Whether this provider requires authentication."
        },
        "completionUrlRelativePath": {
          "type": "string",
          "description": "Custom relative URL path for completion requests."
        },
        "thinkTagStart": {
          "type": "string",
          "description": "Custom start tag for thinking/reasoning blocks in model responses."
        },
        "thinkTagEnd": {
          "type": "string",
          "description": "Custom end tag for thinking/reasoning blocks in model responses."
        },
        "httpClient": {
          "type": "string",
          "description": "HTTP client implementation to use.",
          "enum": ["jdk", "okhttp"]
        },
        "models": {
          "type": "object",
          "description": "Available models for this provider. Each key is the model alias.",
          "additionalProperties": {
            "$ref": "#/definitions/model"
          }
        }
      },
      "additionalProperties": false
    },
    "model": {
      "type": "object",
      "description": "Configuration for a specific model.",
      "properties": {
        "modelName": {
          "type": "string",
          "description": "The actual model identifier sent to the API, if different from the alias key."
        },
        "extraPayload": {
          "type": "object",
          "description": "Additional fields to include in the API request payload.",
          "additionalProperties": true
        },
        "extraHeaders": {
          "type": "object",
          "description": "Additional HTTP headers to include in API requests.",
          "additionalProperties": {
            "type": "string"
          }
        },
        "reasoningHistory": {
          "type": "string",
          "description": "How to handle reasoning/thinking history in conversation context.",
          "enum": ["all", "turn", "off"],
          "default": "all"
        }
      },
      "additionalProperties": false
    },
    "behavior": {
      "type": "object",
      "description": "A named behavior configuration.",
      "properties": {
        "mode": {
          "type": "string",
          "description": "Behavior mode. 'primary' for standalone behaviors, 'subagent' for agent-spawnable behaviors.",
          "enum": ["primary", "subagent"]
        },
        "defaultModel": {
          "type": "string",
          "description": "Default model for this behavior, overriding the global default.",
          "examples": ["anthropic/claude-sonnet-4.5"]
        },
        "disabledTools": {
          "type": "array",
          "description": "Tools to disable for this behavior.",
          "items": {
            "type": "string"
          }
        },
        "enabledSkills": {
          "type": "array",
          "description": "List of regex patterns matching skill names to enable for this behavior.",
          "items": {
            "type": "string"
          }
        },
        "autoCompactPercentage": {
          "type": "integer",
          "description": "Context window usage percentage at which auto-compact triggers for this behavior.",
          "minimum": 0,
          "maximum": 100
        },
        "toolCall": {
          "$ref": "#/definitions/toolCallConfig"
        },
        "prompts": {
          "$ref": "#/definitions/prompts"
        }
      },
      "additionalProperties": false
    },
    "hook": {
      "type": "object",
      "description": "A hook configuration for running shell actions on events.",
      "required": ["type", "actions"],
      "properties": {
        "type": {
          "type": "string",
          "description": "The event type that triggers this hook.",
          "enum": [
            "sessionStart",
            "sessionEnd",
            "chatStart",
            "chatEnd",
            "preRequest",
            "postRequest",
            "preToolCall",
            "postToolCall"
          ]
        },
        "matcher": {
          "type": "string",
          "description": "Regex pattern for matching server__tool-name. Only for *ToolCall hook types."
        },
        "visible": {
          "type": "boolean",
          "description": "Whether to show hook execution in chat.",
          "default": true
        },
        "runOnError": {
          "type": "boolean",
          "description": "For postToolCall hooks, whether to run even if the tool errored.",
          "default": false
        },
        "actions": {
          "type": "array",
          "description": "List of actions to execute when the hook triggers.",
          "items": {
            "$ref": "#/definitions/hookAction"
          }
        }
      },
      "additionalProperties": false
    },
    "hookAction": {
      "type": "object",
      "description": "A shell action executed by a hook.",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Action type.",
          "enum": ["shell"]
        },
        "shell": {
          "type": "string",
          "description": "Inline shell script to execute."
        },
        "file": {
          "type": "string",
          "description": "Path to a shell script file to execute."
        },
        "timeout": {
          "type": "integer",
          "description": "Timeout in milliseconds for this action.",
          "default": 30000
        }
      },
      "additionalProperties": false
    },
    "customTool": {
      "type": "object",
      "description": "A user-defined command-line tool.",
      "required": ["description", "command", "schema"],
      "properties": {
        "description": {
          "type": "string",
          "description": "Description of what the tool does. Used by the LLM to decide when to use it."
        },
        "command": {
          "type": "string",
          "description": "Command template with {{argument_name}} placeholders."
        },
        "schema": {
          "type": "object",
          "description": "Schema defining the tool's parameters.",
          "properties": {
            "properties": {
              "type": "object",
              "description": "Parameter definitions.",
              "additionalProperties": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "description": "Parameter type."
                  },
                  "description": {
                    "type": "string",
                    "description": "Parameter description for the LLM."
                  }
                }
              }
            },
            "required": {
              "type": "array",
              "description": "List of required parameter names.",
              "items": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "toolCallConfig": {
      "type": "object",
      "description": "Tool call configuration including approval rules and tool-specific settings.",
      "properties": {
        "approval": {
          "$ref": "#/definitions/approval"
        },
        "readFile": {
          "type": "object",
          "description": "Configuration for the read_file tool.",
          "additionalProperties": false,
          "properties": {
            "maxLines": {
              "type": "integer",
              "description": "Maximum number of lines returned by read_file.",
              "default": 2000
            }
          }
        },
        "shellCommand": {
          "type": "object",
          "description": "Configuration for the shell_command tool.",
          "additionalProperties": false,
          "properties": {
            "summaryMaxLength": {
              "type": "integer",
              "description": "Maximum length of shell command summary.",
              "default": 25
            }
          }
        },
        "outputTruncation": {
          "type": "object",
          "description": "Output truncation settings for tool results.",
          "additionalProperties": false,
          "properties": {
            "lines": {
              "type": "integer",
              "description": "Maximum number of lines in tool output.",
              "default": 2000
            },
            "sizeKb": {
              "type": "integer",
              "description": "Maximum size in kilobytes for tool output.",
              "default": 50
            }
          }
        }
      },
      "additionalProperties": false
    },
    "approval": {
      "type": "object",
      "description": "Tool approval configuration.",
      "properties": {
        "byDefault": {
          "type": "string",
          "description": "Default approval mode for tools not explicitly configured.",
          "enum": ["ask", "allow", "deny"],
          "default": "ask"
        },
        "allow": {
          "type": "object",
          "description": "Tools that are automatically allowed. Key is tool or server name.",
          "additionalProperties": {
            "$ref": "#/definitions/approvalMatcher"
          }
        },
        "ask": {
          "type": "object",
          "description": "Tools that require user approval. Key is tool or server name.",
          "additionalProperties": {
            "$ref": "#/definitions/approvalMatcher"
          }
        },
        "deny": {
          "type": "object",
          "description": "Tools that are denied. Key is tool or server name.",
          "additionalProperties": {
            "$ref": "#/definitions/approvalMatcher"
          }
        }
      },
      "additionalProperties": false
    },
    "approvalMatcher": {
      "type": "object",
      "description": "Matcher configuration for a tool approval rule.",
      "properties": {
        "argsMatchers": {
          "type": "object",
          "description": "Map of argument name to list of Java regex patterns to match against.",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "additionalProperties": false
    },
    "mcpServer": {
      "type": "object",
      "description": "MCP server configuration. Use 'url' for remote HTTP servers or 'command' for stdio servers.",
      "properties": {
        "url": {
          "type": "string",
          "description": "URL for remote HTTP-streamable or SSE MCP servers.",
          "format": "uri"
        },
        "command": {
          "type": "string",
          "description": "Command to launch a stdio MCP server."
        },
        "args": {
          "type": "array",
          "description": "Arguments for the stdio MCP server command.",
          "items": {
            "type": "string"
          }
        },
        "env": {
          "type": "object",
          "description": "Environment variables to set for the MCP server process.",
          "additionalProperties": {
            "type": "string"
          }
        },
        "disabled": {
          "type": "boolean",
          "description": "Whether this MCP server is disabled.",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "prompts": {
      "type": "object",
      "description": "Custom prompt configurations. Values support dynamic strings like ${file:path} and ${classpath:path}.",
      "properties": {
        "chat": {
          "type": "string",
          "description": "System prompt for chat interactions."
        },
        "chatTitle": {
          "type": "string",
          "description": "Prompt for generating chat titles."
        },
        "compact": {
          "type": "string",
          "description": "Prompt for compacting chat context."
        },
        "init": {
          "type": "string",
          "description": "Prompt for the /init command."
        },
        "skillCreate": {
          "type": "string",
          "description": "Prompt for skill creation."
        },
        "completion": {
          "type": "string",
          "description": "System prompt for inline completions."
        },
        "rewrite": {
          "type": "string",
          "description": "System prompt for rewrites."
        },
        "tools": {
          "type": "object",
          "description": "Custom descriptions for specific tools. Key is the tool name.",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    }
  }
}
